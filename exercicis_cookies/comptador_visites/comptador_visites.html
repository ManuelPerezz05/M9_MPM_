<?php
session_start();

// Inicialitzar el comptador de visites si no existeix
if (!isset($_SESSION['visites'])) {
    $_SESSION['visites'] = 0;
}

// Incrementar el comptador de visites
$_SESSION['visites']++;

// Calcular descompte en funció del nombre de visites
$descompte = 0;
if ($_SESSION['visites'] >= 10) {
    $descompte = 50;
} elseif ($_SESSION['visites'] >= 5) {
    $descompte = 20;
}

// Si l'usuari aplica el descompte i fa la compra
$preu_producte = 100; // Preu base del producte
$preu_final = $preu_producte;
if (isset($_POST['aplica_descompte']) && $descompte > 0) {
    $preu_final = $preu_producte - ($preu_producte * ($descompte / 100));
}
?>

<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Pàgina del Producte</title>
</head>
<body>

<h1>Compra del Producte</h1>

<p>Nombre de visites: <?php echo $_SESSION['visites']; ?></p>

<?php if ($descompte > 0): ?>
    <p>Felicitats! Tens un descompte del <?php echo $descompte; ?>% en la teva compra.</p>
<?php endif; ?>

<form method="POST">
    <p>Preu original: <?php echo $preu_producte; ?>€</p>
    <p>Preu final amb descompte aplicat: <?php echo $preu_final; ?>€</p>
    <input type="hidden" name="aplica_descompte" value="1">
    <button type="submit">Comprar amb Descompte</button>
</form>

</body>
</html>
